<ui:composition
        xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://xmlns.jcp.org/jsf/passthrough" xmlns:f="http://java.sun.com/jsf/core"
        xmlns:c="http://java.sun.com/jsp/jstl/core">

    <!-- This is the editable experience component. -->
    <!-- Loading the js for custom editors -->
    <h:outputScript library="js" name="mycv_editor_bundle.js" target="body"/>

    <!-- (experiences) -->

    <!-- TEST EDITOR -->
    <h:panelGroup layout="block" class="col-xs-12 mycv-editor" id="experience-#{id}-editor">

        <div class="col-xs-12">

            <!-- Begin of the form -->
            <h:form prependId="false" p:data-toggle="validator"
                    id="experience-#{id}-form" class="mycv-form" p:role="form">


                <!-- At the beginin, updateState is true. Then, if an error occures, during form:execute,
                if will be false. This very form won't be cleaned (but a notification will be).
                If the form is executed right, this will be cleaned (rendered againg), and collapsed
                by an inner js. During the next show, good & clean values will show. -->
                <h:panelGroup layout="block" id="experience-#{id}-fields">

                    <!-- (Experience's title) -->
                    <div class="row">
                        <div class="row-strip col-sm-12">
                            <div class="form-group has-feedback">
                                <label for="experienceTitle-#{id}"
                                       class="control-label">Titre </label>
                                <span class="help-block with-error">- Champs requis.</span>
                                <!--p:pattern="^[_A-z0-9]+$"-->
                                <h:inputText p:type="text" class="form-control"
                                             p:id="experienceTitle-#{id}"
                                             value="#{_experience.jobName}"
                                             p:data-minlength="1"
                                             p:placeholder="Titre" p:data-error=" "/>
                                                <span class="glyphicon form-control-feedback"
                                                      aria-hidden="true"> </span>
                            </div>
                        </div>
                    </div>
                    <!-- (End of Experience's title) -->


                    <!-- (Enterprise name) -->
                    <div class="row">
                        <div class="row-strip col-sm-12">
                            <div class="form-group has-feedback">
                                <label for="enterpriseName-#{id}"
                                       class="control-label">Nom de l'entreprise </label>
                                <span class="help-block with-error">- Champs requis.</span>
                                <!--p:pattern="^[ _A-z0-9]+$"-->
                                <h:inputText p:type="text" class="form-control"
                                             id="enterpriseName-#{id}"
                                             value="#{_experience.companyName}"
                                             p:data-minlength="1"
                                             p:placeholder="Nom de l'entreprise" p:data-error=" "/>
                                                    <span class="glyphicon form-control-feedback"
                                                          aria-hidden="true"></span>
                            </div>
                        </div>
                    </div>
                    <!-- (End of Enterprise name) -->


                    <!-- (Experience's country) -->
                    <div class="row">
                        <div class="row-strip col-sm-12">
                            <div class="form-group">
                                <label for="experiencePlace-#{id}"
                                       class="control-label">Lieu </label>
                                <h:selectOneMenu styleClass="form-control" id="experiencePlace-#{id}"
                                                 value="#{_experience.country}" p:style="height: 36px;">
                                    <f:selectItems
                                            value="#{employeeExperienceBean.countries}" var="_country"
                                            itemLabel="#{_country}" itemValue="#{_country.name()}"/>
                                </h:selectOneMenu>
                            </div>
                        </div>
                    </div>
                    <!-- (End of Experience's country) -->


                    <!-- (Experience's Period) -->
                    <div class="row">
                        <div class="row-strip col-xs-12 no-margin-bot">
                            <div class="form-group has-feedback">
                                <label class="control-label">Période </label><span
                                    class="help-block with-error">- Saisissez deux années comprises entre 1900 et 2016.</span>

                                <div class="row"></div>

                                <div class="row-strip col-sm-5 col-xs-5">
                                    <!-- Start date -->
                                    <div class="row-strip col-xs-6">
                                        <h:selectOneMenu styleClass="form-control"
                                                         value="#{_experience.startMonth}">
                                            <f:selectItems
                                                    value="#{employeeExperienceBean.months}"/>
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="col-xs-6 no-padding-right">
                                        <h:inputText p:type="text"
                                                     class="form-control editor-date-input"
                                                     p:data-minlength="4"
                                                     value="#{_experience.startYear}"
                                                     p:placeholder="Année" p:pattern="^[0-9]+$"
                                                     p:data-error=" "/>
                                    </div>
                                </div>
                                <div class="text-center col-sm-2 col-xs-2">-</div>
                                <div class="row-strip pull-right col-sm-5 col-xs-5 no-padding-right no-margin-left no-margin-bot"
                                     style="margin-bottom:0;">
                                    <!-- End date -->
                                    <div class="row-strip col-xs-6">
                                        <h:selectOneMenu styleClass="form-control"
                                                         value="#{_experience.endMonth}">
                                            <f:selectItems
                                                    value="#{employeeExperienceBean.months}"/>
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="col-xs-5 no-padding-right "
                                         style="float:right; padding:0;">
                                        <h:inputText p:type="text"
                                                     class="form-control editor-date-input"
                                                     p:data-minlength="4"
                                                     value="#{_experience.endYear}"
                                                     p:placeholder="Année" p:pattern="#{regexes.date}"
                                                     p:data-error=" "/>
                                    </div>
                                </div>
                                <div class="row no-margin-bot"></div>
                            </div>
                        </div>
                    </div>
                    <!-- (End of Experience's Period) -->


                    <!-- (Experience's description) -->
                    <div class="row">
                        <div class="row-strip col-sm-12">
                            <div class="form-group has-feedback">
                                <label for="experienceDescription-#{id}"
                                       class="control-label">Description</label>
                                <h:inputTextarea class="form-control" rows="5"
                                                 id="experienceDescription-#{id}"
                                                 p:placeholder="Description..."
                                                 value="#{_experience.jobDescription}"></h:inputTextarea>
                            </div>
                        </div>
                    </div>
                    <!-- (End of Experience's description) -->

                    <!-- Script allowing the panel to close. with hideExperienceEditor. -->
                    <h:panelGroup layout="block" id="experience-#{id}-script">
                        <h:outputScript>(function() {
                            console.log("resultat de la requete ajax #{_experience.updateState}");
                            if (!#{_experience.updateState}) {return;}
                            hideExperienceEditor('experience-#{id}'); })();
                        </h:outputScript>
                    </h:panelGroup>

                    <!-- (Experience's visiblity) -->
                    <div class="row">
                        <div class="row-strip col-sm-12">
                            <div class="form-group">
                                <label for="experienceVisibility-#{id}"
                                       class="control-label">Visibilité </label>
                                <h:selectOneMenu styleClass="form-control" id="experienceVisibility-#{id}"
                                                 value="#{_experience.visibility}" p:style="height: 36px;">
                                    <f:selectItems
                                            value="#{employeeExperienceBean.visibilities}" var="_visibility"
                                            itemLabel="#{_visibility}" itemValue="#{_visibility.name()}"/>
                                </h:selectOneMenu>
                            </div>
                        </div>
                    </div>
                    <!-- (End of Experience's visiblity) -->


                    <!-- Form's Buttons -->
                    <div class="row">

                        <!-- Save Button -->
                        <h:commandButton type="submit" class="btn btn-default" value="Enregistrer"
                                         action="#{_experience.update()}">

                            <!-- Fields will be added dynamically after in the code of the listener. -->
                            <f:ajax execute="@form" listener="#{_experience.dynamicFields}"
                                    render="#{renderList} #{notificationBean.id}"
                                    resetValues="true"/>
                        </h:commandButton>
                        <!-- End of Save Button -->

                        <!-- Cancel Button -->
                        <h:commandButton type="button" class="btn btn-redb"
                                         onclick="hideExperienceEditor('experience-#{id}');"
                                         value="Annuler">
                            <f:ajax render="experience-#{id}-fields"/>
                        </h:commandButton>
                        <!-- End of Cancel Button -->

                        <!-- Remove Button -->
                        <c:if test="#{!isAdding}">
                            <h:commandButton type="button" class="remove-mycv-entry"
                                             value="Retirer ce poste">
                                <f:ajax listener="#{_experience.setRemoved()}"
                                        onevent="function(data) {
                                                    onSuccess(data, removeID, 'experience-#{id}-handle');
                                               }" render="no-experience-hint"/>
                            </h:commandButton>
                        </c:if>
                        <!-- End of Remove Button -->
                    </div>
                </h:panelGroup>
            </h:form>
            <!-- End of the form -->
        </div>
    </h:panelGroup>
    <!-- ENDS OF TEST EDITOR -->
</ui:composition>

