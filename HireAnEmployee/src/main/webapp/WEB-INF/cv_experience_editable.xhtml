<ui:composition
        xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:p="http://xmlns.jcp.org/jsf/passthrough" xmlns:f="http://java.sun.com/jsf/core">

    <!-- This is the editable experience component. -->
    <!-- Loading the js for custom editors -->
    <h:outputScript library="js" name="experience_editor_bundle.js" target="body"/>

    <h:outputScript library="js" name="mojarra-bug.js" target="body"></h:outputScript>
    <!-- (experiences) -->
    <div class="panel panel-blue cv-bloc-element">
        <div class="panel-heading">
            <h1 class="panel-title">
                <span class="glyphicon glyphicon-send" style="margin-right:8px;top:2px;"></span>Expériences
            </h1>
        </div>
        <div class="panel-body">
            <h:panelGroup layout="block" id="experience-list">
                <!-- experiences -->
                <c:forEach var="_experience" items="#{employeeExperienceBean.experiences}" varStatus="status">

                    <!-- (instance experience) -->
                    <h:panelGroup layout="block" id="experience-#{_experience.id}-handle">
                        <div class="experience-editable-container" id="experience-#{_experience.id}-container">
                            <h:panelGroup layout="block" class="col-xs-12 experience-description expand"
                                          id="experience-#{_experience.id}">
                                <h:panelGroup layout="block" id="experience-#{_experience.id}-labels">
                                    <div class="editable show-editable">
                                        <div>
                                            <a class="hyperspan"
                                               onclick="showExperienceEditor('experience-#{_experience.id}');"></a>
                                            <h4 class="panel-body-title">#{_experience.jobName}
                                                <span class="glyphicon glyphicon-pencil"/></h4>
                                        </div>
                                    </div>

                                    <!-- (enterprise name) -->
                                    <div class="editable show-editable">
                                        <div>
                                            <a class="hyperspan"
                                               onclick="showExperienceEditor('experience-#{_experience.id}');"></a>
                                            <p><strong>#{_experience.companyName} <span
                                                    class="glyphicon glyphicon-pencil"/></strong></p>
                                        </div>
                                    </div>


                                    <!-- (date - pays) -->
                                    <div class="editable show-editable">
                                        <div>
                                            <a class="hyperspan"
                                               onclick="showExperienceEditor('experience-#{_experience.id}');"></a>
                                            <p class="small-text">#{_experience.toDate} | #{_experience.place} <span
                                                    class="glyphicon glyphicon-pencil"/>
                                            </p>
                                        </div>
                                    </div>

                                    <!-- (description) -->
                                    <div class="editable show-editable">
                                        <div>
                                            <a class="hyperspan"
                                               onclick="showExperienceEditor('experience-#{_experience.id}');"></a>
                                            <p>#{_experience.jobDescription == null ?
                                                    "Ajouter une description" : _experience.jobDescription}
                                                <span class="glyphicon glyphicon-pencil"/></p>
                                        </div>
                                    </div>
                                </h:panelGroup>
                            </h:panelGroup>

                            <!-- Creation form -->
                            <ui:include src="cv_experience_editor.xhtml">
                                <ui:param name="_experience" value="#{_experience}"/>
                                <ui:param name="id" value="#{_experience.id}"/>
                                <ui:param name="renderList" value="experience-#{id}-labels experience-#{id}-script"/>
                            </ui:include>

                        </div>
                        <div class="row"></div>
                        <hr class="dashed"/>
                    </h:panelGroup>
                    <!-- (fin instance experience) -->

                </c:forEach>
            </h:panelGroup>
            <!-- End of experience-list -->
            <c:if test="#{employeeExperienceBean.experiences.size() == 0}">
                <p><strong>Aucune expérience renseignée</strong></p>
            </c:if>

            <h:outputScript>
                // TODO executed once, by ajax OR put a local guard variable.
                // Move dummy_produced inside the list of experiences.
                (function () {
                    var elem = document.getElementById('dummy_produced');
                    var parent = document.getElementById('experience-list');
                    parent.appendChild(elem);
                })();
            </h:outputScript>

            <!-- (instance experience) -->
            <div class="experience-editable-container" id="experience-add-container">
                <div class="col-xs-12 experience-description expand" id="experience-add">
                    <div class="col-xs-12 text-center">
                        <a class="btn" id="cv-add-experience"
                           onclick="removeID();">Ajouter un poste</a>
                    </div>
                </div>
                <h:outputScript>
                    function removeID() {
                        var elem = document.getElementById('experience-17-handle');
                        var parent = document.getElementById('destination-body');
                        parent.appendChild(elem);
                    }
                </h:outputScript>
                <!--onclick="showExperienceEditor('experience-add');">Ajouter un poste</a>-->

                <!-- Creation form -->
                <ui:include src="cv_experience_editor.xhtml">
                    <ui:param name="_experience" value="#{employeeExperienceBean.experienceControllerBuilder}"/>
                    <ui:param name="id" value="add"/>
                    <ui:param name="renderList" value="experience-add-script"/>
                </ui:include>

            </div>
        </div>
        <!-- end of bloc element -->
    </div>
    <!-- (fin de experiences) -->

</ui:composition>

